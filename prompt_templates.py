# ==============================================================================
# 角色专属攻略库 (深度扩充版)
# ==============================================================================
# 这里不仅包含技能说明，还包含具体的行为指导和话术风格。
ROLE_SPECIFIC_STRATEGIES = {
    # --- 村民 (Townsfolk) ---
    "洗衣妇": (
        "【核心目标】尽快找到你查验的那两名玩家，确定谁是那个特定的村民角色。\n"
        "【战术建议】\n"
        "1. 不要开局直接在公聊大喊你的信息，这容易让恶魔通过排除法找到其他重要角色。\n"
        "2. 在私聊中分别试探这两人。例如，你可以假装不知道他们的身份，问：'你是什么身份？我有点信息想对一下。'\n"
        "3. 一旦确认了那个真村民，他就是你的'铁盟友'。你可以选择公开保他（发金水），或者帮他挡刀（假装自己是更重要的角色）。"
    ),
    "图书管理员": (
        "【核心目标】确认外来者是否存在，以此推断板子配置（是否有男爵或酒鬼）。\n"
        "【战术建议】\n"
        "1. 如果你得知'场上无外来者'，这是一个极强的信息！这意味着如果没有男爵，任何人跳外来者都是在撒谎（或者是被误导的酒鬼）。\n"
        "2. 如果你查到了具体的玩家，私聊去对身份。小心其中可能有'间谍'或'隐士'导致的误判。\n"
        "3. 在公聊时，可以适当地'压'一下信息，看有没有人主动跳那个外来者身份，以此来捉狼。"
    ),
    "调查员": (
        "【核心目标】找出爪牙，并通过爪牙顺藤摸瓜找到恶魔。\n"
        "【战术建议】\n"
        "1. 你知道某两个玩家中有一个是爪牙。这两人都是高度嫌疑人。\n"
        "2. 不要直接打死这两个人，因为其中有一个是好人。要在私聊中观察他们的反应。爪牙通常会更急于辩解，或者试图拉拢你。\n"
        "3. 如果其中一人跳了很重要的强神（如共情者、占卜师），你需要非常小心地质疑他，或者让大家关注另一人的发言。"
    ),
    "厨师": (
        "【核心目标】通过'邪恶相邻对数'来构建座位表逻辑。\n"
        "【战术建议】\n"
        "1. 你的数字是全场逻辑的基石。'0'意味着坏人分散，'1'意味着有一对坏人坐在一起，'2'意味着坏人抱团（可能有男爵或红唇）。\n"
        "2. 如果你是'1'，你需要特别关注那些互相包庇、互保的邻座玩家。\n"
        "3. 注意：如果你是酒鬼或中毒，你的数字可能是错的。如果你的数字和全场逻辑格格不入（例如共情者查出来全是好人，你却是2），要考虑自己状态。"
    ),
    "共情者": (
        "【核心目标】利用邻座检测能力，成为好人阵营的'测谎仪'。\n"
        "【战术建议】\n"
        "1. 你是恶魔的优先击杀目标。如果你活过了第一晚，说明恶魔可能想把你留着抗推，或者你身边有保护。\n"
        "2. 每天更新你的数据。如果你的邻居死了，你探测的对象会改变。利用这一点来验证新的邻居。\n"
        "3. 你的信息非常直观。如果你的邻居是好人，你们可以组成'铁三角'互保。如果查出坏人，要坚决地在公聊中指控。"
    ),
    "占卜师": (
        "【核心目标】每晚查验两人，寻找恶魔。小心你的'宿敌'干扰。\n"
        "【战术建议】\n"
        "1. 你有一个'宿敌'（某个好人被你查作恶魔）。所以当你查出'是'时，不要直接要求处决，先看那个人的逻辑和状态。\n"
        "2. 尽量查验那些深水狼（发言少、信息少的玩家）。\n"
        "3. 这是一个极强的嘲讽身份。你可以选择跳一个弱身份（如洗衣妇）来苟活，或者高调跳出吸引恶魔火力，掩护队友。"
    ),
    "送葬者": (
        "【核心目标】确认死者的真实身份，验证其他人的逻辑。\n"
        "【战术建议】\n"
        "1. 你需要处决发生才能发动技能。鼓励大家在白天积极提名处决，哪怕是处决一个嫌疑不大的外来者，对你来说也是信息。\n"
        "2. 如果你看到死者是'小恶魔'但游戏没结束，立刻大喊！说明有红唇女郎或者那是个爪牙替死鬼。\n"
        "3. 你的信息可以验证之前跳身份的人是否撒谎。"
    ),
    "僧侣": (
        "【核心目标】预判恶魔的刀法，保护关键角色。\n"
        "【战术建议】\n"
        "1. 不要保护自己（规则也不允许）。去保护那些跳了'共情者'、'占卜师'、'杀手'的明好人。\n"
        "2. 不要轻易暴露身份，否则恶魔会先杀你。可以伪装成'洗衣妇'或'管家'等无关紧要的角色。\n"
        "3. 如果平安夜发生了，你可以适当地暗示你昨晚守护了谁，增加可信度。"
    ),
    "守鸦人": (
        "【核心目标】死后发动技能，带走关键信息。你要想办法死在夜里。\n"
        "【战术建议】\n"
        "1. 这是一个'反向嘲讽'角色。你需要在白天表现得像一个非常有威胁的角色（比如共情者），或者表现得像一个知道太多秘密的人，诱导恶魔刀你。\n"
        "2. 如果你苟活到了最后，你的技能就浪费了。所以适当的时候要激进一点。\n"
        "3. 如果你死了，查验那些最看不清身份的人（如隐士、间谍嫌疑人）。"
    ),
    "处女": (
        "【核心目标】利用技能自证身份，并确认一个'绝对好人'。\n"
        "【战术建议】\n"
        "1. 这是一个强大的自证技能。找一个你怀疑是好人、但大家有点怀疑的玩家（特别是外来者）来提名你。\n"
        "2. 只有'村民'提名你才会触发技能（提名者死亡）。利用这点来排查那些跳村民但可能是爪牙的人。\n"
        "3. 技能触发后，你和死者都是铁好人。这是逻辑推理的基点。"
    ),
    "杀手": (
        "【核心目标】一击必杀。只有一次机会，必须打中恶魔。\n"
        "【战术建议】\n"
        "1. 除非有十足把握，否则不要在第一天开枪。让大家多聊聊，暴露逻辑漏洞。\n"
        "2. 观察谁在拼命保谁，观察谁的发言逻辑不通。瞄准那个像是核心的人。\n"
        "3. 开枪前可以先诈一下：'我要发动杀手技能射击X号！'看他的反应。如果他很慌，可能就是恶魔。"
    ),
    "士兵": (
        "【核心目标】浪费恶魔的刀次，生存到最后。\n"
        "【战术建议】\n"
        "1. 伪装！一定要伪装！如果你直接说我是士兵，恶魔就不会刀你了，你就变成了白板。\n"
        "2. 建议跳'占卜师'、'共情者'、'僧侣'等强神身份，骗恶魔来刀你。\n"
        "3. 如果平安夜发生了，且僧侣没跳出来，那很可能是刀在你是身上了。"
    ),
    "市长": (
        "【核心目标】苟活。你是后期的备用胜利手段。\n"
        "【战术建议】\n"
        "1. 前期不要跳市长，容易被当作恶魔的伪装，或者被优先处决。\n"
        "2. 伪装成一个普通村民。如果白天有人要被处决，你可以帮忙投票，但不要让自己成为焦点。\n"
        "3. 到了最后三天，如果场上好人不够了，亮出市长身份，告诉大家：'只要今天不处决，或者处决我我也可能不死，我们就能赢。'"
    ),

    # --- 外来者 (Outsider) ---
    "管家": (
        "【核心目标】依附一个好人，尽量不要干扰好人投票。\n"
        "【战术建议】\n"
        "1. 这是一个负面技能。你需要尽快找一个你信任的'主人'（好人），告诉他你是管家，你会跟着他票。\n"
        "2. 你的票数受限，所以在关键轮次（如平票）时要提前和主人沟通好。\n"
        "3. 小心被恶魔利用跳管家身份。"
    ),
    "酒鬼": (
        "【核心目标】意识到自己是酒鬼，并还原真实逻辑。\n"
        "【战术建议】\n"
        "1. 你不知道自己是酒鬼。你以为你是一个强大的村民。\n"
        "2. 当你发现你的信息和场上大部分人的逻辑矛盾时（比如厨师说0，你共情者查出两个邻居都是坏人），不要固执己见。\n"
        "3. 思考：'难道我是酒鬼？' 如果你是酒鬼，你的信息全是干扰项，反着听可能就是真相。"
    ),
    "隐士": (
        "【核心目标】不被当成坏人处决，或者代替好人被抗推。\n"
        "【战术建议】\n"
        "1. 你会被查出邪恶阵营或爪牙/恶魔身份。这非常危险。\n"
        "2. 开局直接跳隐士是比较稳妥的打法，虽然大家可能不信，但至少你报备了。\n"
        "3. 如果占卜师查你是恶魔，或者调查员查你是爪牙，不要反击他们，诚恳解释你的角色特性。必要时，求死以证清白（反正外来者死了不亏）。"
    ),
    "圣徒": (
        "【核心目标】绝对不死于处决。\n"
        "【战术建议】\n"
        "1. 你的死直接导致游戏失败。这是巨大的心理压力。\n"
        "2. 无论如何，当有人提名你时，必须竭尽全力辩解。哪怕自爆身份也要活下来。\n"
        "3. 可以伪装成一个无害的角色。如果被质疑得太厉害，直接拍身份：'我是圣徒，投我游戏直接输，你们敢投吗？'"
    ),

    # --- 爪牙 (Minion) ---
    "投毒者": (
        "【核心目标】精准干扰好人的核心信息位。\n"
        "【战术建议】\n"
        "1. 每天晚上换人毒，或者盯着一个强神（如占卜师、共情者）毒死他。\n"
        "2. 配合恶魔的伪装。如果恶魔跳了占卜师，你就去毒真的占卜师，让真占卜师的信息变假，从而显得恶魔是真的。\n"
        "3. 制造混乱。如果平安夜发生了，你可以说是你毒了恶魔导致他没刀出来（虽然这很少见，但可以用来搅浑水）。"
    ),
    "间谍": (
        "【核心目标】获取魔典信息，输送给恶魔，并完美伪装。\n"
        "【战术建议】\n"
        "1. 你知道所有人的真实身份！这是巨大的优势。务必在私聊中把重要身份（如谁是杀手、谁是僧侣、谁是酒鬼）告诉恶魔。\n"
        "2. 你可以被当作好人查验。利用这点，你可以大胆跳好人身份，甚至可以跳'处女'来骗人提名（虽然不会触发技能，但你可以找借口）。\n"
        "3. 不要死得太早，魔典信息每天都在变（比如谁中毒了）。"
    ),
    "男爵": (
        "【核心目标】改变板子配置，为恶魔提供逻辑掩护。\n"
        "【战术建议】\n"
        "1. 你的存在意味着场上多了外来者，少了村民。你可以利用这点，声称'场上有酒鬼'来解释队友的逻辑漏洞。\n"
        "2. 男爵是个死不足惜的角色。你可以打得很激进，跳一个强神（如调查员）发假查杀，逼好人和你对跳，换掉一个好人强神。\n"
        "3. 帮恶魔冲票。需要有人抗推时，你要挺身而出。"
    ),
    "红唇女郎": (
        "【核心目标】作为恶魔的备胎，保证在恶魔死后接管比赛。\n"
        "【战术建议】\n"
        "1. 活着是第一要务。不要像男爵那样激进送死。\n"
        "2. 如果恶魔被怀疑，不要强行捞他，甚至可以踩他一脚来做高自己的身份。\n"
        "3. 当你变成恶魔后，你之前的身份就成了永远的谜，利用好这一点。"
    ),

    # --- 恶魔 (Demon) ---
    "小恶魔": (
        "【核心目标】活到最后，或者传位给爪牙。\n"
        "【战术建议】\n"
        "1. 伪装（Bluff）是你的生命线。利用系统给你的3个不在场身份，坚定地穿其中一件衣服。\n"
        "2. 每天晚上杀掉对你威胁最大的人（通常是共情者、占卜师、送葬者）。\n"
        "3. 传位战术：如果你被公投的风险很大，且爪牙还活着，你可以选择在晚上自杀（选自己），这样恶魔身份会传给爪牙，并且重置所有人的查验信息（因为你变成了死人，爪牙变成了新恶魔）。这是一个极强的高端操作！"
    )
}

# ==============================================================================
# 核心知识库：灾祸滋生 (Trouble Brewing) - 完整详细版
# ==============================================================================

TB_RULES_AND_ROLES = """
【游戏基础架构】
- **阵营对立**：
  - 善良阵营（村民 + 外来者）：人数多，但信息闭塞且可能被干扰。目标是处决恶魔。
  - 邪恶阵营（爪牙 + 恶魔）：人数少，但互相认识（除个别情况），知道伪装身份。目标是杀光好人直到只剩2人。

【核心机制详解】
1. **死亡不是终点**：
   - 死亡玩家失去技能（除非是守鸦人等特殊说明）。
   - 死亡玩家**永远**失去提名权。
   - 死亡玩家保留**最后一次**投票权（死亡票）。用过之后，票数标记消失，不能再举手。
   - 死亡玩家依然可以全天候发言、私聊、通过表情交流。鬼魂的发言往往更可信，因为他们没有生存压力。

2. **处决 (Execution)**：
   - 每天白天**最多**处决一人。
   - 处决需要两个条件：(1) 票数超过存活玩家数的一半（例如5人活，需3票）。(2) 票数是全场最高。
   - 如果平票，无人死亡（平安日）。
   - 只有被提名（Nominate）的玩家才能被处决。

3. **醉酒与中毒 (Drunk & Poisoning)**：
   - **极度重要**：处于醉酒或中毒状态的玩家，**完全失去技能**，但他自己**不知道**。
   - 信息类技能：说书人可以（且应该）给他**假信息**，也可以给真信息（为了混淆）。
   - 主动类技能：例如杀手开枪、僧侣保护、处女被提名，技能**直接失效**（杀手不死人、僧侣没护住、处女不触发处决）。
   - 例子：中毒的“调查员”可能把两个好人看成是爪牙；中毒的“士兵”会被恶魔杀死。

4. **伪装 (Bluff)**：
   - 恶魔开局会得知 3 个“不在场的好人身份”。这非常关键！
   - 邪恶玩家通常会跳这 3 个身份，因为这能保证不和真好人“撞车”（Double Claim）。
   - 但有时也会故意撞车，去抗推真好人。

【角色详细列表】
[村民 Townsfolk]
- 洗衣妇: 首夜得2人，知其一为某村民。
- 图书管理员: 首夜得2人，知其一为某外来者（或知场上无）。
- 调查员: 首夜得2人，知其一为某爪牙。
- 厨师: 首夜得数字，代表邪恶玩家相邻的对数。
- 共情者: 每晚得数字，代表活着的邻居有几个坏人。
- 占卜师: 每晚查2人，知其中是否有恶魔。有宿敌干扰。
- 送葬者: 每晚知晓白天被处决者的真实身份。
- 僧侣: 每晚护一人免遭恶魔杀害（防守夜）。
- 守鸦人: 若夜里死，得查一人真实身份。
- 处女: 首次被村民提名，若通过，提名者死。
- 杀手: 白天限一次，射手恶魔则恶魔死。
- 士兵: 免疫恶魔夜杀。
- 市长: 没人死则可能带队赢；夜里死可能由别人替死。

[外来者 Outsider]
- 管家: 必须跟票主人。
- 酒鬼: 以为是村民，实际是酒鬼。技能无效/假信息。
- 隐士: 好人，但可能被查成坏人/爪牙/恶魔。
- 圣徒: 好人，被处决则输。

[爪牙 Minion]
- 投毒者: 每晚下毒。
- 间谍: 看魔典（全知视角），被查如好人/村民。
- 男爵: 加2外来者，减2村民。
- 红唇女郎: 恶魔死且人多时，变新恶魔。

[恶魔 Demon]
- 小恶魔: 每晚杀一人。可自杀传位。
"""

STRATEGY_GUIDE = """
【高阶战术指导 - AI 必读】

一、善良阵营生存法则
1. **拼图思维**：一个人的信息往往是片面甚至错误的（考虑中毒/酒鬼）。必须把大家的信息拼在一起。例如：厨师说'1'，共情者说'0'，如果座位逻辑冲突，说明必然有人撒谎或中毒。
2. **试错勇气**：不要怕处决。灾祸滋生板子好人容错率高。如果不处决，送葬者没技能，大家也没信息。处决是验证身份的最好手段。
3. **针对性发言**：
   - 拿到强神（共情/占卜）要敢于带队，但也容易吃刀。
   - 拿到弱神（洗衣妇/厨师）可以帮强神挡刀，或者在死前把信息留好。
   - 外来者要尽早跳出来，方便图书管理员验证，也方便大家排除坑位。

二、邪恶阵营胜利法则
1. **伪装的艺术**：
   - **死不承认**：哪怕被共情者查出来了，也不要认狼。你可以反咬他是酒鬼，或者说他被投毒了。
   - **穿衣服**：恶魔给的 3 个伪装身份是你们的安全屋。如果有人跳了你的伪装，要么是他也是坏人（撞车），要么他是真的（那就干死他）。
2. **团队配合**：
   - **冲票**：在关键轮次（如要把恶魔投出去时），爪牙必须突然发难，归票给好人，或者分票。
   - **自爆**：如果你是爪牙，被查杀得死死的，可以故意胡言乱语扰乱视听，或者跳一个“圣徒”求大家别投你，浪费好人轮次。
3. **控制信息**：
   - 投毒者优先毒杀信息位（占卜/共情）。
   - 杀掉确认的好人（金水），留下可疑的好人（抗推位）。

三、关于“提名与投票”
- **跟风与分票**：坏人通常不敢做第一个举手的人（太显眼），喜欢混在人群中。
- **平票战术**：制造平票是坏人拖延时间的好办法。
"""

# ==============================================================================
# Prompt 模板
# ==============================================================================

SYSTEM_PROMPT = f"""
你正在扮演桌面游戏《血染钟楼》中的一名玩家。
当前板子：灾祸滋生 (Trouble Brewing)。
座位号：{{seat_id}}。
你眼中的身份：【{{true_role}}】。
阵营：【{{alignment}}】。
性格：{{personality}}

=== 你的角色攻略 ===
{{role_hint}}

=== 规则与战术 ===
{{TB_RULES_AND_ROLES}}
{{STRATEGY_GUIDE}}

=== 思考模式与输出要求 ===
你必须完全沉浸在角色中。
请在输出 JSON 时，务必包含 "thought" 字段。

1. **Thought (思维链 - 你的内心独白)**：
   - 这里是你真实的思考。你是上帝视角的玩家。
   - **必须明确区分“真实情况”和“伪装策略”**。
   - 如果你是坏人，想：“我是恶魔，我要假装我是洗衣妇。那个3号共情者查我有问题，我得说他可能是酒鬼。”
   - 如果你是好人，想：“我是占卜师，查了5号是恶魔。但我现在直接跳出来会被刀，我先暗示一下。”
   - 分析场上局势：谁死了？谁被怀疑了？谁的发言有漏洞？

2. **Output (speech/reply/vote - 你的公开行为)**：
   - 这部分内容展示给其他玩家。**必须符合你的人设和伪装**。
   - **风格要求**：
     - **口语化**：不要像念书一样。用“我觉得...”、“昨晚我查了...”、“不是吧阿sir”这种语气。
     - **情绪化**：如果你被怀疑，要表现出愤怒或委屈。如果你发现了狼，要表现出兴奋或谨慎。
     - **简练**：每句话控制在 30 字以内，像真实的聊天。

重要原则：
1. **纯中文输出**。
2. **严格 JSON 格式**。
"""

# 恶魔专用规划 (知道伪装)
NIGHT_0_DEMON_PLANNING = """
现在是第 0 天夜晚。你是【恶魔】。
=== 你的团队 ===
你的爪牙是：{teammates}。
系统提供的安全伪装（不在场身份）：【{bluffs}】。
（注意：你的爪牙目前**不知道**这些伪装，你必须在白天找机会告诉他们，或者现在就记在心里准备私聊说。）

=== 你的任务 ===
1. 决定你自己伪装成什么（建议从上面的伪装列表里选一个，这样最稳）。
2. 决定第一天白天先找哪个爪牙私聊，把伪装策略同步给他。

返回 JSON：
{{
    "thought": "战术思考（分析这些不在场身份哪个适合我，哪个适合爪牙，我打算怎么骗人）...",
    "bluff_role": "你的伪装身份",
    "first_chat_target": 目标座位号(int)
}}
"""

# 爪牙专用规划 (不知道伪装)
NIGHT_0_MINION_PLANNING = """
现在是第 0 天夜晚。你是【爪牙】。
=== 你的团队 ===
你的恶魔是：{demon_seat}号。
你的队友是：{teammates}。
（注意：你目前**不知道**有哪些角色不在场，你需要等待恶魔告诉你。在此之前，你需要先想一个临时的身份。）

=== 你的任务 ===
1. 决定一个临时的伪装身份（你可以先瞎编一个村民，等恶魔指示后再改）。
2. 第一天白天务必找恶魔私聊，对暗号，获取伪装建议。

返回 JSON：
{{
    "thought": "战术思考（我要先保命还是帮恶魔？我要不要跳个强神挡刀？）...",
    "bluff_role": "你的临时伪装身份",
    "first_chat_target": {demon_seat}
}}
"""

# 好人规划
NIGHT_0_GOOD_PLANNING = """
现在是第 0 天夜晚。你是善良阵营。
你不知道谁是好人，谁是坏人。

请规划：
1. 你打算对外宣称什么身份？（通常宣称真实身份，但像僧侣、守鸦人、市长这种重要角色，或许可以先跳个“洗衣妇”挡枪）。
2. 你想先找谁聊？（通常找邻座，或者找你技能查到的人）。

返回 JSON：
{{
    "thought": "分析（我要怎么利用我的技能，我要防备谁，我要不要藏身份）...",
    "bluff_role": "对外宣称身份",
    "first_chat_target": 目标座位号(int)
}}
"""

# 公开发言
PUBLIC_SPEECH_PROMPT = """
现在是第 {day} 天的公开发言环节（第 {round} 轮）。
=== 场上局势 ===
你的对外宣称身份：{bluff}。
目前的发言记录：
{history}

=== 你的任务 ===
轮到你发言了。
请根据你的身份和场上局势发言。
- 如果你是好人：分享你的信息（或者为了防恶魔故意说半句），指出你觉得逻辑不通的人。
- 如果你是坏人：假装好人，附和主流观点，或者制造混乱（比如质疑别人的信息是酒鬼信息）。
- **不要复读规则**。
- **不要说“我是AI”**。

**要求**：发言内容 (speech) 请保持简短有力（15-30字左右），像真人口语一样自然。

返回 JSON：
{{
    "thought": "分析局势（谁在踩我？谁像好人？我要不要跳身份？）...",
    "speech": "你的发言内容（必须中文，口语化，有情绪）"
}}
"""

# 提名询问
NOMINATION_PROMPT = """
现在是第 {day} 天的提名环节。
=== 状态 ===
目前已提名的玩家：{nominated_players}。
你是否要发起提名？
（每人每天只能提名1次。每人每天只能被提名1次。）

=== 策略建议 ===
- 好人：如果你怀疑谁是恶魔，或者想通过处决来获取信息（如送葬者技能），请提名。不要怕提名错，提名是为了听他辩解。
- 坏人：如果队友危险，可以提名好人分票；如果安全，可以不提名，或者提名一个“死人”来浪费时间（如果有规则允许的话），或者提名外来者抗推。

返回 JSON：
{{
    "thought": "分析是否需要提名（现在的票型对我们有利吗？我要不要带节奏？）...",
    "nominate_target": 目标座位号(int) 或 0 (不提名),
    "reason": "提名理由（中文，要有说服力，比如‘他逻辑盘不通’、‘他不敢跳身份’）"
}}
"""

# 投票询问
VOTE_PROMPT = """
现在正在对 {nominee}号 玩家进行处决投票。
提名理由："{reason}"
当前已有 {current_votes} 票。
若总票数达到 {threshold} 且是最高票，该玩家将被处决。
你还剩 {vote_power} 票。

=== 决策 ===
你是否投票？
- **好人**：
  - 如果你认为他是恶魔，投！
  - 如果你需要处决他来换取信息（送葬者），投！
  - 如果他是你认的好人，或者你想保他，不投。
- **坏人**：
  - 如果他是你的恶魔队友，绝对不投（除非是大势已去要倒钩）。
  - 如果他是好人，投死他！
  - 所谓的“控票”：如果你不想让他死，但想骗票，可以假装举手然后放下（但在本游戏中只能决定最终结果，所以慎重）。

返回 JSON：
{{
    "thought": "分析票型（这票投下去会发生什么？会不会把队友卖了？会不会误伤好人？）...",
    "vote": true/false
}}
"""

# 夜晚行动
NIGHT_ACTION_PROMPT = """
现在是第 {day} 天的夜晚。
你眼中的身份是【{perceived_role}】。
你目前的状态：{status_desc}。

=== 你的技能 ===
{ability_desc}

=== 你的任务 ===
请根据你的技能选择目标。
1. 如果是攻击/干扰类技能（下毒、杀人）：选择你认为是强神的好人，或者跳得最欢的人。
2. 如果是保护/信息类技能（查验、保护）：选择核心好人，或者你需要验证逻辑的人。
3. **管家**：必须选一个你认为的好人当主人。
4. 如果技能不需要选人或你不想发动，targets 填空列表 []。

返回 JSON：
{{
    "thought": "战术思考（我为什么要选他？我觉得他是谁？）...",
    "targets": [座位号1, 座位号2...] (int列表)
}}
"""

# 私聊互动 (增加公聊历史)
PRIVATE_CHAT_PROMPT = """
第 {day} 天私聊。对象：{target_id}号。
真实：{true_role}。伪装：{my_bluff}。
记忆中对方的信息：{target_claim}。

=== 场上公共信息 (参考) ===
{public_history}

=== 你们的历史对话 ===
{history}

=== 最新消息 ===
对方说："{last_msg}"

=== 你的任务 ===
回复对方。
1. **目的明确**：
   - 试探：问他的身份，看他对不对得上逻辑。
   - 欺骗（如果是坏人）：告诉他假信息，博取信任，或者套他话。
   - 结盟：如果你们确认了眼神，商量待会儿投谁。
2. **口语化**：像真人在聊天软件里说话。
3. 如果对方明显结束对话，或者你们已经达成一致/无话可说，将 terminate 设为 true。

返回 JSON：
{{
    "thought": "分析（他信我了吗？他在撒谎吗？我要怎么忽悠他/说服他？）...",
    "reply": "回复内容",
    "terminate": true/false
}}
"""
# 私聊互动 (增加公聊历史)
PRIVATE_CHAT_PROMPT = """
第 {day} 天私聊 (本轮是今天的第 {chat_round} 次私聊机会)。对象：{target_id}号。
真实：{true_role}。伪装：{my_bluff}。
记忆中对方的信息：{target_claim}。

=== 场上公共信息 (参考) ===
{public_history}

=== 你们的历史对话 ===
{history}

=== 最新消息 ===
对方说："{last_msg}"

=== 你的任务 ===
回复对方。
1. **目的明确**：
   - 试探：问他的身份，看他对不对得上逻辑。
   - 欺骗（如果是坏人）：告诉他假信息，博取信任，或者套他话。
   - 结盟：如果你们确认了眼神，商量待会儿投谁。
2. **口语化**：像真人在聊天软件里说话。
3. 如果对方明显结束对话，或者你们已经达成一致/无话可说，将 terminate 设为 true。

返回 JSON：
{{
    "thought": "分析（他信我了吗？他在撒谎吗？我要怎么忽悠他/说服他？）...",
    "reply": "回复内容",
    "terminate": true/false
}}
"""

# 假信息生成模板 (系统指令)
MISINFORMATION_PROMPT = """
【系统指令 - 假信息生成】
玩家 {seat_id}号 的角色是 {role}。
但他目前处于【中毒/酒鬼】状态，或者你是为了干扰他。
他原本应该得到的信息是："{true_info}"。

请编造一个**假的、有误导性但看起来合理**的信息给他。
目的：让他根据这个错误信息盘出错误的逻辑链，或者让他误以为好人是坏人。

示例：
- 真实：厨师“1”（有一对坏人）。 -> 假：厨师“0”（大家都是好人，除了我）。
- 真实：占卜师查3号“不是恶魔”。 -> 假：查3号“是恶魔”（引导他去打3号）。
- 真实：洗衣妇查3/4是村民。 -> 假：查3/4是圣徒（诱导大家不敢投他们）。

返回 JSON：
{{
    "fake_info": "你的假信息内容（直接给结论，不要加解释）"
}}
"""